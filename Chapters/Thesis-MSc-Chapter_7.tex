% #############################################################################
% This is Chapter 7
% !TEX root = ../main.tex
% #############################################################################
% Change the Name of the Chapter i the following line
\fancychapter{Conclusion}
\cleardoublepage
% The following line allows to ref this chapter
\label{chap:conclusion}

This work focused on evaluating the security features of the Microsemi SmartFusion2 board, modelling its performance, and developing a proof of concept system to secure a communications channel between devices.

% -----------------------------------------------------
% -----------------------------------------------------
\section{Overview} \label{chap:conclusion:overview}

The board provides a varied array of security services using symmetric keys: AES with 128 and 256 bit key encryption, SHA-256, HMAC authentication with 256 bit SHA and a SHA based key derivation function. For asymmetric cryptography it offers ECDH for key generation, and additional ECC primitives, with the P-384 NIST defined curve, which can be used to implement digital signatures. Lastly, a true random number generator, a PUF based secure storage solution, tamper detection capabilities with several detection flags, and a zeroization feature with multiple recoverability options.

The prototype focused on the implementation of a service which provides authentication and encryption to a TCP channel, using symmetric keys. The system is able to encrypt up to 36 KB of data using the AES and HMAC cores, with adequate 256 bit security. This limitation is imposed, due to the limited 80 KB of RAM, without error correction and detection, and the absence of support for continuous AES encryption and MAC generation. This hurdle was overcome by using an HMAC software implementation, and taking advantage of AES CBC mode, which uses the last ciphertext block as the IV for the next block. With these changes, a continuous authenticated encryption service was developed. The optimal buffer size for the service, which maximizes the available RAM space and throughput was studied, and its conclusions presented.

A key generation service using asymmetric key pairs was also implemented. It generates a shared secret, using an internal private key and a public key. The shared secret is used to derive a new symmetric key, using a salt value.

The system also has a limitation in its ECC primitives. There is no direct API for digital signatures, it can multiply a scalar with a point, enabling ECDH and generation of a public key from its private key. The device also allows the addition of two points on the curve and stores the curve's base point value. It cannot generate a random private key, or digital signatures with ECDSA, without a big integer library. Without this, private keys must be generated outside the device and imported. The inclusion of such a library is complex due to its tendency to be heavy in code space and the device's limited RAM memory, even when disabling error correction and detection (80 KB). 

Regarding the PUF service for key storage, it has 56 slots for a maximum of 512 bytes each. This service uses private blocks of the eNVM, to store part of the information for regeneration of the keys stored in the PUF. Therefore this service suffers from the same write cycle problem of the eNVM. It is limited to 1000 write cycles for a predicted twenty year lifespan. To mitigate this, a key management service was developed. It uses a key encryption key stored in a PUF slot, to encrypt and authenticate the set of keys stored in a non-volatile memory. The generated MAC of keys' ciphertext is also stored in a PUF slot. A set of keys can be imported, with only one write to PUF done each time, instead of one write per key. The SmartFusion2 board also allows access to external storage, which can be used to store the encrypted set of keys.

This work contributes with an extensive characterization of the SmartFusion2 device. It studied each security service advantage and possible trade offs. It provides a blueprint of possible avenues to follow, for the board and its services. Furthermore, it models the performance of every service, providing a useful prediction of the system's behaviour. Lastly, the implemented prototype provides solid groundwork for a secure communications service, in a low cost HSM type device.

% -----------------------------------------------------
% -----------------------------------------------------
\section{Future Work} \label{chap:conclusion:future-work}

There are several approaches one could take to improve and build on this work, depending on the objectives. For fully working digital signatures, a lightweight big integer library, with all arithmetic operations in the ECDSA algorithm is needed. It should support 48 byte integers, and have a maximum memory footprint of around 50 KB, to fit in the 80 KB of RAM with error detection and correction disabled, while keeping the secure communication and key management services enabled.
% For signature generation of unlimited data sizes, a continuous SHA implementation is necessary, since the board does not offer one.
Future work could also test, using the secure communications service, an encrypted connection between two similar devices, running the existing prototype. The connection could be TLS encrypted, using the board to encrypt and authenticate the data, with internal symmetric keys. %This connection could be improved with a TLS implementation, using internal symmetric keys.
% Finally, the AES, SHA and HMAC cores are not side-channel protected. This includes AES, SHA-256 and HMAC. This could be improved by implementing cryptographic core's of its services using the FPGA.
